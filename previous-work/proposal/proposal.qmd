---
title: "Proposal"
author: "Pandas - June Lee, Victoria Midkiff, Alan Wang, Jessica Tang"
format: pdf
editor: visual
---

```{r}
#| label: load-pkg-data
#| warning: false
library(tidyverse)
library(tidymodels)
library(patchwork)
nfl_baseline <- read_csv("nfl_elo.csv", show_col_types = FALSE)
```

## Introduction

Sources for Introduction:

<https://github.com/fivethirtyeight/data/tree/master/nfl-elo>

<https://www.nfl.com/100/original-towns/>

<https://www.history.com/this-day-in-history/nfl-and-afl-announce-merger>

The history of the National Football League (NFL) can be traced back to 1920, when fourteen charter teams from thirteen "Original Towns" came together in September 1920 to form the American Professional Football Association. Over the NFL's century-old history, thousands of games and 52 Super Bowls have been played, with statistics recorded for each game. Today, many people enjoy betting on which football team will win the Super Bowl each year, using a variety of historical data and trends to compete with others. Elo ratings is a method that FiveThirtyEight uses to evaluate strengths of teams based on past performance. We were particularly interested in looking at this data for games played in the year 2000 and later.

**Research Question:** How will the home team's and away team's Elo ratings predict the score difference (score1 - score2, i.e. \# of points home team scores minus \# of points away team scores) in a game?

**Hypotheses:**

1.  The home teams' Elo ratings (as predictors will increase the score difference by a higher amount compared to those of the away team.

2.  The Elo ratings before a game for each team will be predictors that have the largest influence on the score difference compared to the other predictor variables, on average, holding all else constant.

3.  The Elo ratings for the home team will increase the score difference, whereas the Elo ratings for the away team will decrease the score difference.

## Data description

The data was taken from FiveThirtyEight. The observations are for a single NFL game, and include information about both of the teams that are playing. It includes each team's Elo rating (measure of strength based on game-by-game results) before and after the game, and the prior and post Elo rating for the quarterbacks playing in the game. It also includes the score of the game and the overall quality of the game, based on the harmonic mean of the Elo values of both teams before the game. FiveThirtyEight calculated all Elo values in the data set using data from Pro-Football-Reference.com. The data was collected from the results of NFL games from 1920 to 2022.

## Exploratory data analysis

```{r data-cleaning}
# data cleaning
nfl_recent <- nfl_baseline |>
  drop_na(qbelo1_pre | qbelo2_pre | qbelo_prob1 | qbelo_prob2 | score1 )

nfl_elo <- nfl_recent |>
  mutate(score_diff = score1 - score2)
```

Data cleaning process:

1.  Filter out the original dataset nfl_baseline by only including games for which qbelo1_pre, qbelo2_pre, qbelo_prob1, qbelo_prob2, and score1 are available, since these are the main predictor variables we are interested in looking at.
2.  Use the mutate function to append a new variable "score_diff," calculated by taking the Home team's score (score1) and subtracting it by the Away team's score (score2) for each game. Note that this new variable is an integer, and can be both positive (Home team won) and negative (Away team won).

**Response Variable:**

```{r score-diff-dist, fig.width=4,fig.height=1.75}
#univariate distribution of response variable score_diff
ggplot(data = nfl_elo, aes(x = score_diff)) +
  geom_histogram(binwidth = 1) + labs(title = "Distribution of Score Difference",
                          x = "Score Difference", y = "Count")

summary(nfl_elo$score_diff)
```

Note that, while the general distribution of the score difference between the Home and Away teams is roughly normally distributed with a mean of 2.655674 points and standard deviation of 15.17104 points, the distribution appears to be multimodal when setting the binwidth of the histogram equal to 1. This is because of common score differences, namely 3 when winning by a field goal, 7 when winning by a touchdown plus extra point, etc. When also considering that the NFL rules make ties difficult to come by, the distribution of score differences is better explained by its median of 3 and interquartile range of 19.

**Potential Predictor Variables:**

```{r pred-var-dists, fig.width=7,fig.height=3}
#elo1_pre
p1 <- ggplot(data = nfl_elo, aes(x = elo1_pre)) +
  geom_histogram(bins=20) + labs(title = "Distribution of Home Team ELO, Before the Game", x = "Home Team ELO", y = "Count")

#elo2_pre
p2 <- ggplot(data = nfl_elo, aes(x = elo2_pre)) +
  geom_histogram(bins=20) + labs(title = "Distribution of Away Team ELO, Before the Game", x = "Away Team ELO", y = "Count")

#qb1_value_pre
p3 <- ggplot(data = nfl_elo, aes(x = qb1_value_pre)) +
  geom_histogram(bins=20) + labs(title = "Distribution of Home Team Starting QB Raw ELO, Before the Game", x = "QB Raw ELO (Home)", y = "Count")

#qb2_value_pre
p4 <- ggplot(data = nfl_elo, aes(x = qb2_value_pre)) +
  geom_histogram(bins=20) + labs(title = "Distribution of Away Team Starting QB Raw ELO, Before the Game", x = "QB Raw ELO (Away)", y = "Count")

#qb1_game_value
p5 <- ggplot(data = nfl_elo, aes(x = qb1_game_value)) +
  geom_histogram(bins=20) + labs(title = "Distribution of Home Team QB ELO, During the Game", x = "QB ELO (Home)", y = "Count")

#qb2_game_value
p6 <- ggplot(data = nfl_elo, aes(x = qb2_game_value)) +
  geom_histogram(bins=20) + labs(title = "Distribution of Away Team QB ELO, During the Game", x = "QB ELO (Away)", y = "Count")

(p1 | p2 | p3) / (p4 | p5 | p6)
```

Most of the distributions of the predictor variables are unimodal and roughly normally distributed, except for the distributions of the raw ELO of the Home team's starting quarterback before the game and the raw ELO of the Away team's starting quarterback before the game, both of which are unimodal and right-skewed.

**Relationships between Response and Predictor Variables:**

```{r response-vs-pred, fig.width=8,fig.height=3}
# score_diff vs elo1_pre
p1 <- ggplot(data = nfl_elo, aes(x = elo1_pre, y = score_diff)) +
  geom_point() + geom_smooth(formula = y ~ x, method = "lm") + labs(title = "Score Difference by Home Team Pregame ELO", y = "Score Difference", x = "Home Team Pregame ELO")

# score_diff vs elo2_pre
p2 <- ggplot(data = nfl_elo, aes(x = elo2_pre, y = score_diff)) +
  geom_point() + geom_smooth(formula = y ~ x, method = "lm") + labs(title = "Score Difference by Away Team Pregame ELO", y = "Score Difference", x = "Away Team Pregame ELO")

# score_diff vs qb1_value_pre
p3 <- ggplot(data = nfl_elo, aes(x = qb1_value_pre, y = score_diff)) +
  geom_point() + geom_smooth(formula = y ~ x, method = "lm") + labs(title = "Score Difference by Home Team Starting QB Pregame Raw ELO", y = "Score Difference", x = "Home Team Starting QB Pregame Raw ELO")

# score_diff vs qb2_value_pre
p4 <- ggplot(data = nfl_elo, aes(x = qb2_value_pre, y = score_diff)) +
  geom_point() + geom_smooth(formula = y ~ x, method = "lm") + labs(title = "Score Difference by Away Team Starting QB Pregame Raw ELO", y = "Score Difference", x = "Away Team Starting QB Pregame Raw ELO")

# score_diff vs qb1_game_value
p5 <- ggplot(data = nfl_elo, aes(x = qb1_game_value, y = score_diff)) +
  geom_point() + geom_smooth(formula = y ~ x, method = "lm") + labs(title = "Score Difference by Home QB ELO, During the Game", y = "Score Difference", x = "Home QB ELO During the Game")

# score_diff vs qb2_game_value
p6 <- ggplot(data = nfl_elo, aes(x = qb2_game_value, y = score_diff)) +
  geom_point() + geom_smooth(formula = y ~ x, method = "lm") + labs(title = "Score Difference by Away QB ELO, During the Game", y = "Score Difference", x = "Away QB ELO During the Game")

(p1 | p2 | p3) / (p4 | p5 | p6)
```

**Relationship Between Predictors:**

```{r predictor-relationships, fig.width=7,fig.height=3}
# elo1_pre vs qb1_value_pre
p1 <- ggplot(data = nfl_elo, aes(x = qb1_value_pre, y = elo1_pre)) +
  geom_point() + geom_smooth(formula = y ~ x, method = "lm") + labs(title = "Home Team Pregame ELO by Home QB Raw Pregame ELO", y = "Home Team ELO", x = "Home QB Raw ELO")

# elo2_pre vs qb2_value_pre
p2 <- ggplot(data = nfl_elo, aes(x = qb2_value_pre, y = elo2_pre)) +
  geom_point() + geom_smooth(formula = y ~ x, method = "lm") + labs(title = "Away Team Pregame ELO by Away QB Raw Pregame ELO", y = "Away Team ELO", x = "Away QB Raw ELO")

# qb1_value_pre vs qb1_game_value
p3 <- ggplot(data = nfl_elo, aes(x = qb1_value_pre, y = qb1_game_value)) +
  geom_point() + geom_smooth(formula = y ~ x, method = "lm") + labs(title = "Home QB ELO During the Game by Home QB Raw Pregame ELO", y = "Home QB ELO During the Game", x = "Home QB Raw ELO Pregame")

# qb2_value_pre vs qb2_game_value
p4 <- ggplot(data = nfl_elo, aes(x = qb2_value_pre, y = qb2_game_value)) +
  geom_point() + geom_smooth(formula = y ~ x, method = "lm") + labs(title = "Away QB ELO During the Game by Away QB Raw Pregame ELO", y = "Away QB ELO During the Game", x = "Away QB Raw ELO Pregame")

(p1 | p2) / (p3 | p4)
```

**Potential Interaction Effects:**

```{r interaction-effects, fig.width=5,fig.height=3.5}
# interaction effect between qb_game_value and which round of the playoff the game is under
nfl_playoff <- nfl_elo |>
  drop_na(playoff)

p1 <- ggplot(data = nfl_playoff, aes(x = qb1_game_value, y = score_diff, color = playoff)) +
  geom_point() + geom_smooth(formula = y ~ x, method = "lm") + 
  labs(x = "Home QB ELO During the Game", y = "Score Difference", color = 'Playoff',
       title = "Score Difference by Home QB ELO During the Game, Playoffs")

# interaction effect between qbelo_prob1 and which round of the playoff the game is under
p2 <- ggplot(data = nfl_playoff, aes(x = qbelo_prob1, y = score_diff, color = playoff)) +
  geom_point() + geom_smooth(formula = y ~ x, method = "lm") + 
  labs(x = "Home Team Probability of Winning based on QB Adj. ELO", y = "Score Difference",
       color = 'Playoff', title = "Score Difference by Home Team Probability of Win Based on QB Adj. ELO, Playoffs")

p1 / p2
```

## Analysis approach

The response variable is the difference in number of points between the home team and away team (score1-score2). Potential predictors include the winning and losing team's Elo ratings, their probabilities of winning the game, and whether they are the home team or the away team. We plan on using multiple linear regression to assess how the Elo ratings for home and away teams will predict the score difference between the home and away teams.

## Data dictionary

The data dictionary can be found in the README.md file in the data folder of the project repository.
